<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="referrer" content="no-referrer"/>
  <title>LAYOUTPLACE Shop</title>

  <!-- –°—Ç–∏–ª–∏ —Å –∫—ç—à-–±–∞—Å—Ç–∏–Ω–≥–æ–º -->
  <link rel="stylesheet" href="./style.css?v=7"/>

  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –ù–∞—à —Ñ—Ä–æ–Ω—Ç -->
  <script src="./app.js?v=7" defer></script>
</head>
<body>

  <!-- ===== –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ ===== -->
  <div id="imgViewer" class="hidden">
    <img src="" alt="preview"/>
  </div>

  <header class="topbar">
    <div>
      <div id="shopTitle" class="shop-title"></div>
      <div id="subtitle" class="subtitle"></div>
    </div>
    <button id="cartBtn" class="cart-btn" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
      üõí <span id="cartCount">0</span>
    </button>
  </header>

  <main class="container">
    <!-- –ì–µ—Ä–æ–π —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º (—Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π) -->
    <div id="hero" class="hero hidden"></div>

    <div id="categories" class="cat-grid"></div>
    <div id="products" class="products"></div>
  </main>

  <footer class="bottom">
    <button id="writeBtn" class="btn ghost">–ù–∞–ø–∏—Å–∞—Ç—å</button>
    <button id="checkoutBtn" class="btn primary">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
  </footer>

  <div id="sheet" class="sheet hidden"></div>
  <div id="backdrop" class="backdrop hidden"></div>

  <script>
    // === –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –ø—Ä–∞–≤–∫–∏ app.js) ===
    const viewer = document.getElementById("imgViewer");
    const viewerImg = viewer.querySelector("img");
    let startY = 0, scale = 1, startDist = 0;

    function openViewer(src) {
      if (!src) return;
      viewerImg.src = src;
      viewer.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }

    function closeViewer() {
      viewer.classList.add("hidden");
      viewerImg.src = "";
      document.body.style.overflow = "";
      scale = 1;
      viewerImg.style.transform = "scale(1)";
    }

    // —Å–≤–∞–π–ø –≤–Ω–∏–∑ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
    viewer.addEventListener("touchstart", (e) => {
      if (e.touches.length === 1) startY = e.touches[0].clientY;
      if (e.touches.length === 2) {
        const dx = e.touches[1].clientX - e.touches[0].clientX;
        const dy = e.touches[1].clientY - e.touches[0].clientY;
        startDist = Math.sqrt(dx*dx + dy*dy);
      }
    });

    viewer.addEventListener("touchmove", (e) => {
      if (e.touches.length === 1 && startY) {
        const deltaY = e.touches[0].clientY - startY;
        if (deltaY > 120) closeViewer();
      }
      if (e.touches.length === 2 && startDist) {
        const dx = e.touches[1].clientX - e.touches[0].clientX;
        const dy = e.touches[1].clientY - e.touches[0].clientY;
        const newDist = Math.sqrt(dx*dx + dy*dy);
        scale *= newDist / startDist;
        startDist = newDist;
        scale = Math.max(1, Math.min(scale, 4)); // –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑—É–º
        viewerImg.style.transform = `scale(${scale})`;
      }
    });

    viewer.addEventListener("click", closeViewer);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !viewer.classList.contains("hidden")) closeViewer();
    });

    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞ (–∏ —Ç–æ–≤–∞—Ä–æ–≤, –∏ –ª–æ–≥–æ—Ç–∏–ø–∞)
    document.body.addEventListener("click", (e) => {
      const img = e.target.closest(".thumb img, .hero-img img");
      if (!img) return;
      const src = img.getAttribute("src");
      if (src) openViewer(src);
    });
  </script>

</body>
</html>